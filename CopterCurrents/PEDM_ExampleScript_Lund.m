%PEDM analysis of Lund 2015 data fig. 6, extracted by calibrated mouse
%clicks from PDF (i.e. not actual official data).

data = [0.03347441026676006, 0.26106870229007634
0.0353133569978512, 0.23473282442748092
0.034371920743651536, 0.2267175572519084
0.03401695297567462, 0.18435114503816796
0.03772690038346016, 0.16259541984732825
0.03736243515011931, 0.11106870229007632
0.04111155960253108, 0.12709923664122136
0.042043498391366806, 0.12595419847328246
0.03902686595514822, 0.21641221374045802
0.04183099260384884, 0.22099236641221373
0.04369368299834981, 0.21755725190839695
0.044340697826267615, 0.2416030534351145
0.047135327009604315, 0.2370229007633588
0.045527880996758995, 0.18664122137404582
0.048001970724063016, 0.17290076335877863
0.050497429748435886, 0.17977099236641222
0.04896952500801349, 0.20610687022900764
0.052377927890494225, 0.19351145038167938
0.053345482174444694, 0.2267175572519084
0.06272185485498559, 0.2702290076335878
0.05580651288687331, 0.20038167938931298
0.0576810751130792, 0.2083969465648855
0.05891099687770826, 0.1946564885496183
0.059851245948737426, 0.2015267175572519
0.061094226728241906, 0.20038167938931298
0.05764071088528249, 0.16946564885496182
0.05481284057317204, 0.14198473282442747
0.064798238220175, 0.17290076335877863
0.06573017700901074, 0.1717557251908397
0.0636003704011492, 0.21755725190839695
0.06670129284247267, 0.2083969465648855
0.06824819251362292, 0.20038167938931298
0.07011207009129439, 0.19809160305343512
0.07137879453420869, 0.2198473282442748
0.07417698526705685, 0.21870229007633588
0.07573456958674155, 0.22099236641221373
0.07634122018686265, 0.20610687022900764
0.07851257820569137, 0.20038167938931298
0.07977930264860567, 0.22213740458015266
0.08320670046181425, 0.22786259541984732
0.08257037028243087, 0.21412213740458017
0.08443424786010235, 0.2118320610687023
0.08599895527880998, 0.22099236641221373
0.0866139161611245, 0.21412213740458017
0.0878533353911175, 0.20954198473282443
0.08941210689397268, 0.21297709923664124
0.09127954602115561, 0.21412213740458017
0.09345209122315484, 0.20954198473282443
0.0919277480322439, 0.23931297709923666
0.09534920992960005, 0.23931297709923666
0.09720715159141904, 0.23129770992366414
0.09844419645507106, 0.22442748091603054
0.09874574098037588, 0.2152671755725191
0.10092303491505705, 0.2152671755725191
0.10310151603290872, 0.21641221374045802
0.10343036577113485, 0.233587786259542
0.10558629040874717, 0.21297709923664124
0.10748459629836288, 0.24389312977099237
0.10902081132097872, 0.22557251908396947
0.11150321133047619, 0.2198473282442748
0.11245414505003978, 0.2370229007633588
0.1143097123455178, 0.2267175572519084
0.1161830873885532, 0.233587786259542
0.11803865468403123, 0.22328244274809161
0.1202159486187124, 0.22328244274809161
0.12207982619638387, 0.22099236641221373
0.12487682974606153, 0.21870229007633588
0.12644747308062165, 0.233587786259542
0.1282959172770767, 0.21641221374045802
0.1298784324433417, 0.24274809160305344
0.132041480179977, 0.22900763358778625
0.13361212351453708, 0.24389312977099237
0.13578704308287728, 0.2416030534351145
0.13888202960834828, 0.2267175572519084
0.1398329633279119, 0.24389312977099237
0.1429243883038714, 0.22557251908396947
0.1435666543991073, 0.2450381679389313
0.14668063585530616, 0.24847328244274808
0.14883774767608898, 0.22900763358778625
0.1501032849358328, 0.24961832061068703
0.1529097859508744, 0.2564885496183206
0.15477128916220484, 0.25190839694656486
0.15632293756603713, 0.24847328244274808
0.15974439946339325, 0.24847328244274808
0.16159996675887128, 0.23816793893129773
0.16378200942623442, 0.24274809160305344
0.16596642645993856, 0.24961832061068703
0.16845357520211798, 0.24847328244274808
0.17031270404710747, 0.2416030534351145
0.1718643524509397, 0.23816793893129773
0.17497595954079762, 0.23931297709923666
0.17747735448102292, 0.25190839694656486
0.17936022698942225, 0.26793893129770996
0.18182719361770333, 0.24732824427480915
0.1849399878907317, 0.24961832061068703
0.18650113375992786, 0.2553435114503817
0.19023363764795273, 0.2553435114503817
0.19366103546116134, 0.26106870229007634
0.1961363123716359, 0.24847328244274808
0.19832547813802195, 0.2599236641221374
0.20081381406337187, 0.2599236641221374
0.20236071373452214, 0.25190839694656486
0.20546994645803907, 0.250763358778626
0.2076531763085727, 0.2564885496183206
0.2110817613049518, 0.2633587786259542
0.21356178694810826, 0.2553435114503817
0.2154422850901666, 0.26908396946564883
0.2185432075314901, 0.2599236641221374
0.22135208291287267, 0.26908396946564883
0.2235222537485309, 0.26221374045801527
0.22601533840656282, 0.266793893129771
0.2285072358814242, 0.2702290076335878
0.23222905512091466, 0.2599236641221374
0.23379732408913378, 0.27251908396946567
0.23690774399582118, 0.27251908396946567
0.23969881162964637, 0.2645038167938931
0.24157693540536374, 0.27595419847328245
0.24406408414754316, 0.2748091603053435
0.2468717723457553, 0.2828244274809161
0.24997150760390827, 0.27251908396946567
0.25308667624327763, 0.2770992366412214
0.2549612384694835, 0.28511450381679393
0.2580609737276364, 0.2748091603053435
0.26024539076134057, 0.2816793893129771
0.2633569978511985, 0.2828244274809161
0.26647335367373837, 0.2885496183206107
0.26895100495055385, 0.2782442748091603
0.2723712796647395, 0.2770992366412214
0.2754757636555744, 0.27137404580152674
0.2785897451117733, 0.2748091603053435
0.28108876568565766, 0.28511450381679393
0.28450073011764987, 0.27595419847328245
0.2876253962223832, 0.28969465648854964
0.29010542186553967, 0.2816793893129771
0.2929131100637518, 0.28969465648854964
0.29539669725641976, 0.28511450381679393
0.29881697197060536, 0.28396946564885495];

[kvals,inds] = sort(data(:,1)');
u = data(inds,2)';

%kvals - wavenumber values in [rad/m]
%u - Doppler shift values in [m/s]

figure(1);plot(kvals,u,'x');
xlim([0.03,0.3]);ylim([0,0.35]);
ylabel('Doppler shift velocity [m/s]');xlabel('k [rad/m]');


effDepths = -(2*kvals).^-1;%Effective depths for each k-value
figure(2);plot(...
    u,effDepths,'x');
xlim([0,0.4]);
xlabel('Doppler shift velocity [m/s]');ylabel('Depth [m]');


%% Perform PEDM.

zvect = linspace(effDepths(1),0,400);

[pPEDM,pEDM,eps_PEDM,eps_EDM] = pedm(kvals,u,[],[],[],[]);

figure(3);hp = plot(...
    u,effDepths,'x',...
    polyval(pEDM,zvect),zvect,'-.',...
    polyval(pPEDM,zvect),zvect,'--k');
xlim([0,0.4]);

ylim([min(effDepths),0]);
hl = legend('$\{Z_{\mathrm{eff}}(k_i),u_i\}$','EDM','PEDM','Location','nw');legend boxoff;
set(hl,'Interpreter','latex');
xlabel('[m/s]','Interpreter','latex');
ylabel('$z$ [m]','Interpreter','latex');
drawnow;

